<head>
<style>
pre { line-height: 125%; }
td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.catala-code .hll { background-color: #ffffcc }
.catala-code { background: #ffffff; }
.catala-code .c { color: #888888 } /* Comment */
.catala-code .err { color: #FF0000; background-color: #FFAAAA } /* Error */
.catala-code .k { color: #008800; font-weight: bold } /* Keyword */
.catala-code .o { color: #333333 } /* Operator */
.catala-code .ch { color: #888888 } /* Comment.Hashbang */
.catala-code .cm { color: #888888 } /* Comment.Multiline */
.catala-code .cp { color: #557799 } /* Comment.Preproc */
.catala-code .cpf { color: #888888 } /* Comment.PreprocFile */
.catala-code .c1 { color: #888888 } /* Comment.Single */
.catala-code .cs { color: #cc0000; font-weight: bold } /* Comment.Special */
.catala-code .gd { color: #A00000 } /* Generic.Deleted */
.catala-code .ge { font-style: italic } /* Generic.Emph */
.catala-code .gr { color: #FF0000 } /* Generic.Error */
.catala-code .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.catala-code .gi { color: #00A000 } /* Generic.Inserted */
.catala-code .go { color: #888888 } /* Generic.Output */
.catala-code .gp { color: #c65d09; font-weight: bold } /* Generic.Prompt */
.catala-code .gs { font-weight: bold } /* Generic.Strong */
.catala-code .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.catala-code .gt { color: #0044DD } /* Generic.Traceback */
.catala-code .kc { color: #008800; font-weight: bold } /* Keyword.Constant */
.catala-code .kd { color: #008800; font-weight: bold } /* Keyword.Declaration */
.catala-code .kn { color: #008800; font-weight: bold } /* Keyword.Namespace */
.catala-code .kp { color: #003388; font-weight: bold } /* Keyword.Pseudo */
.catala-code .kr { color: #008800; font-weight: bold } /* Keyword.Reserved */
.catala-code .kt { color: #333399; font-weight: bold } /* Keyword.Type */
.catala-code .m { color: #6600EE; font-weight: bold } /* Literal.Number */
.catala-code .s { background-color: #fff0f0 } /* Literal.String */
.catala-code .na { color: #0000CC } /* Name.Attribute */
.catala-code .nb { color: #007020 } /* Name.Builtin */
.catala-code .nc { color: #BB0066; font-weight: bold } /* Name.Class */
.catala-code .no { color: #003366; font-weight: bold } /* Name.Constant */
.catala-code .nd { color: #555555; font-weight: bold } /* Name.Decorator */
.catala-code .ni { color: #880000; font-weight: bold } /* Name.Entity */
.catala-code .ne { color: #FF0000; font-weight: bold } /* Name.Exception */
.catala-code .nf { color: #0066BB; font-weight: bold } /* Name.Function */
.catala-code .nl { color: #997700; font-weight: bold } /* Name.Label */
.catala-code .nn { color: #0e84b5; font-weight: bold } /* Name.Namespace */
.catala-code .nt { color: #007700 } /* Name.Tag */
.catala-code .nv { color: #996633 } /* Name.Variable */
.catala-code .ow { color: #000000; font-weight: bold } /* Operator.Word */
.catala-code .w { color: #bbbbbb } /* Text.Whitespace */
.catala-code .mb { color: #6600EE; font-weight: bold } /* Literal.Number.Bin */
.catala-code .mf { color: #6600EE; font-weight: bold } /* Literal.Number.Float */
.catala-code .mh { color: #005588; font-weight: bold } /* Literal.Number.Hex */
.catala-code .mi { color: #0000DD; font-weight: bold } /* Literal.Number.Integer */
.catala-code .mo { color: #4400EE; font-weight: bold } /* Literal.Number.Oct */
.catala-code .sa { background-color: #fff0f0 } /* Literal.String.Affix */
.catala-code .sb { background-color: #fff0f0 } /* Literal.String.Backtick */
.catala-code .sc { color: #0044DD } /* Literal.String.Char */
.catala-code .dl { background-color: #fff0f0 } /* Literal.String.Delimiter */
.catala-code .sd { color: #DD4422 } /* Literal.String.Doc */
.catala-code .s2 { background-color: #fff0f0 } /* Literal.String.Double */
.catala-code .se { color: #666666; font-weight: bold; background-color: #fff0f0 } /* Literal.String.Escape */
.catala-code .sh { background-color: #fff0f0 } /* Literal.String.Heredoc */
.catala-code .si { background-color: #eeeeee } /* Literal.String.Interpol */
.catala-code .sx { color: #DD2200; background-color: #fff0f0 } /* Literal.String.Other */
.catala-code .sr { color: #000000; background-color: #fff0ff } /* Literal.String.Regex */
.catala-code .s1 { background-color: #fff0f0 } /* Literal.String.Single */
.catala-code .ss { color: #AA6600 } /* Literal.String.Symbol */
.catala-code .bp { color: #007020 } /* Name.Builtin.Pseudo */
.catala-code .fm { color: #0066BB; font-weight: bold } /* Name.Function.Magic */
.catala-code .vc { color: #336699 } /* Name.Variable.Class */
.catala-code .vg { color: #dd7700; font-weight: bold } /* Name.Variable.Global */
.catala-code .vi { color: #3333BB } /* Name.Variable.Instance */
.catala-code .vm { color: #996633 } /* Name.Variable.Magic */
.catala-code .il { color: #0000DD; font-weight: bold } /* Literal.Number.Integer.Long */

</style>
<meta http-equiv='Content-Type' content='text/html; charset=utf-8'/>
</head>
<h1>Legislative text implementation<br />
<small>Document generated by Catala version 0.5.0</small>
</h1>
<p>
Source files weaved in this document
</p>
<ul>
<li><tt>tutorial_en.catala_en</tt>, last modification 2022-03-28, 18:59</li>
</ul>
<h1 class='law-heading'><a href='#'>The Catala language tutorial</a></h1>
<p class='law-text'>Welcome to this tutorial, whose objective is to guide you through the features
of the Catala language and teach you how to annotate a legislative text using
the language. This document is addressed primarily to developers or people that
have a programming background, though tech-savvy lawyers will probably figure
things out.</p>
<div class='code-wrapper'>
<div class='filename'>tutorial_en.catala_en</div>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>
<span class="normal"><a href="#tutorial_en.catala_en-11">11</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-12">12</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-13">13</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-14">14</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-15">15</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-16">16</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-17">17</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-18">18</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-19">19</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-20">20</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-21">21</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-22">22</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-23">23</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-24">24</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-25">25</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-26">26</a></span>
</pre></div></td><td class="code"><div class="highlight"><pre>
<a id="tutorial_en.catala_en-11" name="tutorial_en.catala_en-11"></a><span class="c1"># Welcome to the code mode of Catala. This is a comment, because the line is</span>
<a id="tutorial_en.catala_en-12" name="tutorial_en.catala_en-12"></a><span class="c1"># prefixed by #.</span>
<a id="tutorial_en.catala_en-13" name="tutorial_en.catala_en-13"></a>
<a id="tutorial_en.catala_en-14" name="tutorial_en.catala_en-14"></a><span class="c1"># This tutorial does not cover the installation of Catala. For more</span>
<a id="tutorial_en.catala_en-15" name="tutorial_en.catala_en-15"></a><span class="c1"># information about this, please refer the readme at:</span>
<a id="tutorial_en.catala_en-16" name="tutorial_en.catala_en-16"></a><span class="c1"># https://github.com/CatalaLang/catala#building-and-installation</span>
<a id="tutorial_en.catala_en-17" name="tutorial_en.catala_en-17"></a>
<a id="tutorial_en.catala_en-18" name="tutorial_en.catala_en-18"></a><span class="c1"># If you want to get started with your own Catala program to follow this</span>
<a id="tutorial_en.catala_en-19" name="tutorial_en.catala_en-19"></a><span class="c1"># tutorial, simply create an empty file with the extension .catala_en</span>
<a id="tutorial_en.catala_en-20" name="tutorial_en.catala_en-20"></a><span class="c1"># and start typing your program.</span>
<a id="tutorial_en.catala_en-21" name="tutorial_en.catala_en-21"></a>
<a id="tutorial_en.catala_en-22" name="tutorial_en.catala_en-22"></a><span class="c1"># For a complete reference of the Catala syntax, see:</span>
<a id="tutorial_en.catala_en-23" name="tutorial_en.catala_en-23"></a><span class="c1"># https://github.com/CatalaLang/catala/raw/master/doc/syntax/syntax.pdf</span>
<a id="tutorial_en.catala_en-24" name="tutorial_en.catala_en-24"></a>
<a id="tutorial_en.catala_en-25" name="tutorial_en.catala_en-25"></a><span class="c1"># This tutorial itself is written as a Catala program and can be accessed at:</span>
<a id="tutorial_en.catala_en-26" name="tutorial_en.catala_en-26"></a><span class="c1"># https://github.com/CatalaLang/catala/blob/master/examples/tutorial_en</span>
</pre></div>
</td></tr></table>
</div>

<h2 class='law-heading'><a href='#'>Literate programming</a></h2>
<p class='law-text'>To begin writing a Catala program, you must start from the text of the
legislative source that will justify the code that you will write. Concretely,
that means copy-pasting the text of the law into a Catala source file and
formatting it according so that Catala can understand it. Catala source files
have the ".catala_en" extension. If you were to write a Catala program for a
French law, you would use the ".catala_fr" extension; for Polish law,
"catala_pl", etc.<br/>
You can write any kind of plain text in Catala, and it will be printed as is
in PDF or HTML output. You can split your text into short lines of less than
80 characters, terminal-style, and those will appear as a single paragraph
in the output. If you want to create a new paragraph, you have to leave a blank
line in the source. The syntax for non-code text in a Catala program follows
a subset of Markdown that supports titles and Catala block codes.<br/>
Catala allows you to declare section or subsection headers as it is done
here, with the "#" symbol. You can define heading of lower
importance by adding increasing numbers of "#" after the title of the heading.
Generally, the literate programming syntax of Catala follows the syntax of
Markdown (though it does not have all of its features).<br/>
In the rest of this tutorial, we will analyze a fictional example that
defines an income tax. This income tax is defined through several articles
of law, each of them introduced by a header. Here is the first one:</p>
<h3 class='law-heading'><a href='#'>Article 1</a></h3>
<p class='law-text'>The income tax for an individual is defined as a fixed percentage of the
individual's income over a year.</p>
<div class='code-wrapper'>
<div class='filename'>tutorial_en.catala_en</div>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>
<span class="normal"><a href="#tutorial_en.catala_en-62">62</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-63">63</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-64">64</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-65">65</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-66">66</a></span>
</pre></div></td><td class="code"><div class="highlight"><pre>
<a id="tutorial_en.catala_en-62" name="tutorial_en.catala_en-62"></a><span class="c1"># We will soon learn what to write here in order to translate the meaning</span>
<a id="tutorial_en.catala_en-63" name="tutorial_en.catala_en-63"></a><span class="c1"># of the article into Catala code.</span>
<a id="tutorial_en.catala_en-64" name="tutorial_en.catala_en-64"></a>
<a id="tutorial_en.catala_en-65" name="tutorial_en.catala_en-65"></a><span class="c1"># To create a block of Catala code in your file, bound it with Mardown-style</span>
<a id="tutorial_en.catala_en-66" name="tutorial_en.catala_en-66"></a><span class="c1"># &quot;```catala&quot; and &quot;```&quot; delimiters.</span>
</pre></div>
</td></tr></table>
</div>
<p class='law-text'>To translate that fictional income tax definition into a Catala program,
we will intertwine short snippets of code between the sentences of
the legislative text. Each snippet of code should be as short as possible and
as close as possible to the actual sentence that justifies the code. This style
is called literate programming, a programming paradigm invented by the famous
computer scientist Donald Knuth in the 70s.</p>
<h2 class='law-heading'><a href='#'>Defining a fictional income tax</a></h2>
<p class='law-text'>The content of article 1 uses a lot of implicit context: there exists an
individual with an income, as well as an income tax that the individual has
to pay each year. Even if this implicit context is not verbatim in the law,
we have to explicit it for programming purposes. Concretely, we need a
"metadata" section that defines the shape and types of the data used
inside the law.<br/>
Let's start our metadata section by declaring the type information for the
individual, the taxpayer that will be the subject of the tax computation.
This individual has an income and a number of children, both pieces of
information which will be needed for tax purposes :</p>
<div class='code-wrapper code-metadata'>
<div class='filename'>tutorial_en.catala_en</div>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>
<span class="normal"><a href="#tutorial_en.catala_en-91"> 91</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-92"> 92</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-93"> 93</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-94"> 94</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-95"> 95</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-96"> 96</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-97"> 97</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-98"> 98</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-99"> 99</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-100">100</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-101">101</a></span>
</pre></div></td><td class="code"><div class="highlight"><pre>
<a id="tutorial_en.catala_en-91" name="tutorial_en.catala_en-91"></a><span class="kd">declaration</span> <span class="kd">structure</span> <span class="nc">Individual</span><span class="o">:</span><span class="c1"></span>
<a id="tutorial_en.catala_en-92" name="tutorial_en.catala_en-92"></a><span class="c1">  # The name of the structure &quot;Individual&quot;, must start with an</span>
<a id="tutorial_en.catala_en-93" name="tutorial_en.catala_en-93"></a><span class="c1">  # uppercase letter: this is the CamelCase convention.</span>
<a id="tutorial_en.catala_en-94" name="tutorial_en.catala_en-94"></a>  <span class="kd">data</span> <span class="nv">income</span> <span class="kd">content</span> <span class="kt">money</span><span class="c1"></span>
<a id="tutorial_en.catala_en-95" name="tutorial_en.catala_en-95"></a><span class="c1">  # In this line, &quot;income&quot; is the name of the structure field and</span>
<a id="tutorial_en.catala_en-96" name="tutorial_en.catala_en-96"></a><span class="c1">  # &quot;money&quot; is the type of what is stored in that field.</span>
<a id="tutorial_en.catala_en-97" name="tutorial_en.catala_en-97"></a><span class="c1">  # Available types include: integer, decimal, money, date, duration,</span>
<a id="tutorial_en.catala_en-98" name="tutorial_en.catala_en-98"></a><span class="c1">  # and any other structure or enumeration that you declare.</span>
<a id="tutorial_en.catala_en-99" name="tutorial_en.catala_en-99"></a>  <span class="kd">data</span> <span class="nv">number_of_children</span> <span class="kd">content</span> <span class="kt">integer</span><span class="c1"></span>
<a id="tutorial_en.catala_en-100" name="tutorial_en.catala_en-100"></a><span class="c1">  # &quot;income&quot; and &quot;number_of_children&quot; start by a lowercase letter,</span>
<a id="tutorial_en.catala_en-101" name="tutorial_en.catala_en-101"></a><span class="c1">  # they follow the snake_case convention.</span>
</pre></div>
</td></tr></table>
</div>
<p class='law-text'>This structure contains two data fields, "income" and "number_of_children".
Structures are useful to group together data that goes together. Usually, you
get one structure per concrete object on which the law applies (like the
individual). It is up to you to decide how to group the data together,
but you should aim to optimize code readability.<br/>
Sometimes, the law gives an enumeration of different situations. These
enumerations are modeled in Catala using an enumeration type, like:</p>
<div class='code-wrapper code-metadata'>
<div class='filename'>tutorial_en.catala_en</div>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>
<span class="normal"><a href="#tutorial_en.catala_en-114">114</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-115">115</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-116">116</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-117">117</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-118">118</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-119">119</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-120">120</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-121">121</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-122">122</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-123">123</a></span>
</pre></div></td><td class="code"><div class="highlight"><pre>
<a id="tutorial_en.catala_en-114" name="tutorial_en.catala_en-114"></a><span class="kd">declaration</span> <span class="kd">enumeration</span> <span class="nc">TaxCredit</span><span class="o">:</span><span class="c1"></span>
<a id="tutorial_en.catala_en-115" name="tutorial_en.catala_en-115"></a><span class="c1"># The name &quot;TaxCredit&quot; is also written in CamelCase.</span>
<a id="tutorial_en.catala_en-116" name="tutorial_en.catala_en-116"></a><span class="o">--</span> <span class="nc">NoTaxCredit</span><span class="c1"></span>
<a id="tutorial_en.catala_en-117" name="tutorial_en.catala_en-117"></a><span class="c1"># This line says that &quot;TaxCredit&quot; can be a &quot;NoTaxCredit&quot; situation.</span>
<a id="tutorial_en.catala_en-118" name="tutorial_en.catala_en-118"></a><span class="o">--</span> <span class="nc">ChildrenTaxCredit</span> <span class="kd">content</span> <span class="kt">integer</span><span class="c1"></span>
<a id="tutorial_en.catala_en-119" name="tutorial_en.catala_en-119"></a><span class="c1"># This line says that alternatively, &quot;TaxCredit&quot; can be a</span>
<a id="tutorial_en.catala_en-120" name="tutorial_en.catala_en-120"></a><span class="c1"># &quot;ChildrenTaxCredit&quot; situation. This situation carries a content</span>
<a id="tutorial_en.catala_en-121" name="tutorial_en.catala_en-121"></a><span class="c1"># of type integer corresponding to the number of children concerned</span>
<a id="tutorial_en.catala_en-122" name="tutorial_en.catala_en-122"></a><span class="c1"># by the tax credit. This means that if you&#39;re in the &quot;ChildrenTaxCredit&quot;</span>
<a id="tutorial_en.catala_en-123" name="tutorial_en.catala_en-123"></a><span class="c1"># situation, you will also have access to this number of children.</span>
</pre></div>
</td></tr></table>
</div>
<p class='law-text'>In computer science terms, such an enumeration is called a "sum type" or simply
an enum. The combination of structures and enumerations allow the Catala
programmer to declare all possible shapes of data, as they are equivalent to
the powerful notion of "algebraic data types".<br/>
We've defined and typed the data that the program will manipulate. Now we have
to define the logical context in which this data will evolve. This is done in
Catala using "scopes". Scopes are close to functions in terms of traditional
programming. Scopes also have to be declared in metadata, so here we go:</p>
<div class='code-wrapper code-metadata'>
<div class='filename'>tutorial_en.catala_en</div>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>
<span class="normal"><a href="#tutorial_en.catala_en-137">137</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-138">138</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-139">139</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-140">140</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-141">141</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-142">142</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-143">143</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-144">144</a></span>
</pre></div></td><td class="code"><div class="highlight"><pre>
<a id="tutorial_en.catala_en-137" name="tutorial_en.catala_en-137"></a><span class="kd">declaration</span> <span class="kd">scope</span> <span class="nc">IncomeTaxComputation</span><span class="o">:</span><span class="c1"></span>
<a id="tutorial_en.catala_en-138" name="tutorial_en.catala_en-138"></a><span class="c1">  # Scope names use CamelCase.</span>
<a id="tutorial_en.catala_en-139" name="tutorial_en.catala_en-139"></a>  <span class="kd">input</span> <span class="nv">individual</span> <span class="kd">content</span> <span class="nc">Individual</span><span class="c1"></span>
<a id="tutorial_en.catala_en-140" name="tutorial_en.catala_en-140"></a><span class="c1">  # This line declares a scope variable of the scope, which is akin to</span>
<a id="tutorial_en.catala_en-141" name="tutorial_en.catala_en-141"></a><span class="c1">  # a function parameter in computer science term. This is the piece of</span>
<a id="tutorial_en.catala_en-142" name="tutorial_en.catala_en-142"></a><span class="c1">  # data on which the scope will operate.</span>
<a id="tutorial_en.catala_en-143" name="tutorial_en.catala_en-143"></a>  <span class="kd">internal</span> <span class="nv">fixed_percentage</span> <span class="kd">content</span> <span class="kt">decimal</span>
<a id="tutorial_en.catala_en-144" name="tutorial_en.catala_en-144"></a>  <span class="kd">output</span> <span class="nv">income_tax</span> <span class="kd">content</span> <span class="kt">money</span>
</pre></div>
</td></tr></table>
</div>
<p class='law-text'>The scope is the basic abstraction unit in Catala programs, and the declaration
of the scope is akin to a function signature: it contains a list of all the
arguments along with their types. But in Catala, scopes' variables stand
for three things: input arguments, local variables and outputs. The difference
between these three categories can be specified by the different input/output
attributes preceding the variable names. "input" means that the variable has to
be defined only when the scope IncomeTaxComputation is called. "internal" means
that the variable cannot be seen from outside the scope: it is neither an input
nor an output of the scope. "output" means that a caller scope can retrieve the
computed value of the variable. Note that a variable can also be simulataneously
an input and an output of the scope, in that case it should be annotated with
"input output".<br/>
We now have everything to annotate the contents of article 1, which is copied
over below.</p>
<h3 class='law-heading'><a href='#'>Article 1</a></h3>
<p class='law-text'>The income tax for an individual is defined as a fixed percentage of the
individual's income over a year.</p>
<div class='code-wrapper'>
<div class='filename'>tutorial_en.catala_en</div>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>
<span class="normal"><a href="#tutorial_en.catala_en-169">169</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-170">170</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-171">171</a></span>
</pre></div></td><td class="code"><div class="highlight"><pre>
<a id="tutorial_en.catala_en-169" name="tutorial_en.catala_en-169"></a><span class="kd">scope</span> <span class="nc">IncomeTaxComputation</span><span class="o">:</span>
<a id="tutorial_en.catala_en-170" name="tutorial_en.catala_en-170"></a>  <span class="kd">definition</span> <span class="nv">income_tax</span> <span class="kd">equals</span>
<a id="tutorial_en.catala_en-171" name="tutorial_en.catala_en-171"></a>    <span class="nv">individual</span><span class="o">.</span>income <span class="o">*$</span> <span class="nv">fixed_percentage</span>
</pre></div>
</td></tr></table>
</div>
<p class='law-text'>In the code, we are defining inside our scope the amount of the income tax
according to the formula described in the article. When defining formulas,
you have access to all the usual arithmetic operators: addition "+",
subtraction "-", multiplication "*" and division (slash).<br/>
However, in the Catala code, you can see that we use "*$" ("*â‚¬" in French, etc.)
to multiply the individual income by the fixed percentage. The $ suffix
indicates that we are performing a multiplication on an amount of money.
Indeed, in Catala, you have to keep track of what you are dealing with:
is it money ? Is it an integer? Using just "+" or "*" can be ambiguous
in terms of rounding, since money is usually rounded at the cent. So to
disambiguate, we suffix these operations with something that indicates the type
of what we manipulate. The suffixes are "$" for money, "." for decimals, "@"
for dates and the "^" symbol for durations. If you forget the suffix, the Catala type
checker will display an error message that will help you put it where it
belongs.<br/>
Coming back to article 1, one question remains unknown: what is the value of
of the fixed percentage? Often, precise values are defined elsewhere in the
legislative source. Here, let's suppose we have:</p>
<h3 class='law-heading'><a href='#'>Article 2</a></h3>
<p class='law-text'>The fixed percentage mentioned at article 1 is equal to 20 %.</p>
<div class='code-wrapper'>
<div class='filename'>tutorial_en.catala_en</div>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>
<span class="normal"><a href="#tutorial_en.catala_en-200">200</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-201">201</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-202">202</a></span>
</pre></div></td><td class="code"><div class="highlight"><pre>
<a id="tutorial_en.catala_en-200" name="tutorial_en.catala_en-200"></a><span class="kd">scope</span> <span class="nc">IncomeTaxComputation</span><span class="o">:</span>
<a id="tutorial_en.catala_en-201" name="tutorial_en.catala_en-201"></a>  <span class="kd">definition</span> <span class="nv">fixed_percentage</span> <span class="kd">equals</span> <span class="mi">20</span> <span class="o">%</span><span class="c1"></span>
<a id="tutorial_en.catala_en-202" name="tutorial_en.catala_en-202"></a><span class="c1">  # Writing 20% is just an abbreviation for &quot;0.20&quot;.</span>
</pre></div>
</td></tr></table>
</div>
<p class='law-text'>You can see here that Catala allows definitions to be scattered throughout
the annotation of the legislative text, so that each
definition is as close as possible to its location in the text.</p>
<h2 class='law-heading'><a href='#'>Conditional definitions</a></h2>
<p class='law-text'>So far so good, but now the legislative text introduces some trickiness. Let us
suppose the third article says:</p>
<h3 class='law-heading'><a href='#'>Article 3</a></h3>
<p class='law-text'>If the individual is in charge of 2 or more children, then the fixed
percentage mentioned at article 1 is equal to 15 %.</p>
<div class='code-wrapper'>
<div class='filename'>tutorial_en.catala_en</div>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>
<span class="normal"><a href="#tutorial_en.catala_en-220">220</a></span>
</pre></div></td><td class="code"><div class="highlight"><pre>
<a id="tutorial_en.catala_en-220" name="tutorial_en.catala_en-220"></a><span class="c1"># How to redefine fixed_percentage?</span>
</pre></div>
</td></tr></table>
</div>
<p class='law-text'>This article actually gives another definition for the fixed percentage, which
was already defined in article 2. However, article 3 defines the percentage
conditionally to the individual having more than 2 children. Catala allows
you precisely to redefine a variable under a condition:</p>
<div class='code-wrapper'>
<div class='filename'>tutorial_en.catala_en</div>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>
<span class="normal"><a href="#tutorial_en.catala_en-229">229</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-230">230</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-231">231</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-232">232</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-233">233</a></span>
</pre></div></td><td class="code"><div class="highlight"><pre>
<a id="tutorial_en.catala_en-229" name="tutorial_en.catala_en-229"></a><span class="kd">scope</span> <span class="nc">IncomeTaxComputation</span><span class="o">:</span>
<a id="tutorial_en.catala_en-230" name="tutorial_en.catala_en-230"></a>  <span class="kd">definition</span> <span class="nv">fixed_percentage</span> <span class="kd">under condition</span>
<a id="tutorial_en.catala_en-231" name="tutorial_en.catala_en-231"></a>    <span class="nv">individual</span><span class="o">.</span>number_of_children <span class="o">&gt;=</span> <span class="mi">2</span>
<a id="tutorial_en.catala_en-232" name="tutorial_en.catala_en-232"></a>  <span class="kd">consequence</span> <span class="kd">equals</span> <span class="mi">15</span> <span class="o">%</span><span class="c1"></span>
<a id="tutorial_en.catala_en-233" name="tutorial_en.catala_en-233"></a><span class="c1">  # Writing 15% is just an abbreviation for &quot;0.15&quot;.</span>
</pre></div>
</td></tr></table>
</div>
<p class='law-text'>When the Catala program will execute, the right definition will be dynamically
chosen by looking at which condition is true. A correctly drafted legislative
source should always ensure that at most one condition is true at all times.
However, if it is not the case, Catala will let you define a precedence on the
conditions, which has to be justified by the law. But we will see how to
do that later.</p>
<h2 class='law-heading'><a href='#'>Rules</a></h2>
<p class='law-text'>So far, you've learnt how to declare a scope with some variables, and
give definitions to these variables scattered accross the text of
the law at the relevant locations. But there is a pattern very frequent
in legislative texts: what about conditions? A condition is a value that
can be either true or false, like a boolean in programming. However, the
law implicitly assumes a condition is false unless specified otherwise.
This pattern is so common in law that Catala gives it a special syntax. More
precisely, it calls the definition of conditions "rules", which coincides
with the usual meaning law people would give it.<br/>
Here is an example of a condition that might arise in the law:</p>
<h3 class='law-heading'><a href='#'>Article 3 bis</a></h3>
<p class='law-text'>The children eligible for application of article 3</p>
<div class='code-wrapper'>
<div class='filename'>tutorial_en.catala_en</div>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>
<span class="normal"><a href="#tutorial_en.catala_en-263">263</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-264">264</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-265">265</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-266">266</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-267">267</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-268">268</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-269">269</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-270">270</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-271">271</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-272">272</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-273">273</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-274">274</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-275">275</a></span>
</pre></div></td><td class="code"><div class="highlight"><pre>
<a id="tutorial_en.catala_en-263" name="tutorial_en.catala_en-263"></a><span class="c1"># To deal with children eligibility, we create a new scope.</span>
<a id="tutorial_en.catala_en-264" name="tutorial_en.catala_en-264"></a><span class="kd">declaration</span> <span class="kd">scope</span> <span class="nc">Child</span><span class="o">:</span>
<a id="tutorial_en.catala_en-265" name="tutorial_en.catala_en-265"></a>  <span class="kd">input</span> <span class="nv">age</span> <span class="kd">content</span> <span class="kt">integer</span><span class="c1"></span>
<a id="tutorial_en.catala_en-266" name="tutorial_en.catala_en-266"></a><span class="c1">  # The age of the child can be declared as before.</span>
<a id="tutorial_en.catala_en-267" name="tutorial_en.catala_en-267"></a>  <span class="kd">output</span> <span class="nv">is_eligible_article_3</span> <span class="kd">condition</span><span class="c1"></span>
<a id="tutorial_en.catala_en-268" name="tutorial_en.catala_en-268"></a><span class="c1">  # For we declare the eligibility using the special &quot;condition&quot; keyword</span>
<a id="tutorial_en.catala_en-269" name="tutorial_en.catala_en-269"></a><span class="c1">  # that stands for the content of the variable.</span>
<a id="tutorial_en.catala_en-270" name="tutorial_en.catala_en-270"></a>
<a id="tutorial_en.catala_en-271" name="tutorial_en.catala_en-271"></a><span class="kd">scope</span> <span class="nc">Child</span><span class="o">:</span>
<a id="tutorial_en.catala_en-272" name="tutorial_en.catala_en-272"></a>  <span class="kd">rule</span> <span class="nv">is_eligible_article_3</span> <span class="kd">under condition</span> <span class="nv">age</span> <span class="o">&lt;</span> <span class="mi">18</span> <span class="kd">consequence</span> <span class="kd">fulfilled</span><span class="c1"></span>
<a id="tutorial_en.catala_en-273" name="tutorial_en.catala_en-273"></a><span class="c1">  # When defining when a condition is true, we use the special &quot;rule&quot; syntax</span>
<a id="tutorial_en.catala_en-274" name="tutorial_en.catala_en-274"></a><span class="c1">  # instead of &quot;definition&quot;. Rules set conditions to be &quot;fulfilled&quot; or</span>
<a id="tutorial_en.catala_en-275" name="tutorial_en.catala_en-275"></a><span class="c1">  # &quot;not fulfilled&quot; conditionally.</span>
</pre></div>
</td></tr></table>
</div>
<p class='law-text'>When interacting with other elements of the code, condition values behaves
like boolean values.</p>
<h2 class='law-heading'><a href='#'>Functions</a></h2>
<p class='law-text'>Catala lets you define functions anywhere in your scope variable. Indeed,
Catala is a functional language and encourages using functions to describe
relationships between data. Here's what it looks
like in the metadata definition when we want to define a two-brackets tax
computation:</p>
<div class='code-wrapper code-metadata'>
<div class='filename'>tutorial_en.catala_en</div>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>
<span class="normal"><a href="#tutorial_en.catala_en-289">289</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-290">290</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-291">291</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-292">292</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-293">293</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-294">294</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-295">295</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-296">296</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-297">297</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-298">298</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-299">299</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-300">300</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-301">301</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-302">302</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-303">303</a></span>
</pre></div></td><td class="code"><div class="highlight"><pre>
<a id="tutorial_en.catala_en-289" name="tutorial_en.catala_en-289"></a><span class="kd">declaration</span> <span class="kd">structure</span> <span class="nc">TwoBrackets</span><span class="o">:</span>
<a id="tutorial_en.catala_en-290" name="tutorial_en.catala_en-290"></a>  <span class="kd">data</span> <span class="nv">breakpoint</span> <span class="kd">content</span> <span class="kt">money</span>
<a id="tutorial_en.catala_en-291" name="tutorial_en.catala_en-291"></a>  <span class="kd">data</span> <span class="nv">rate1</span> <span class="kd">content</span> <span class="kt">decimal</span>
<a id="tutorial_en.catala_en-292" name="tutorial_en.catala_en-292"></a>  <span class="kd">data</span> <span class="nv">rate2</span> <span class="kd">content</span> <span class="kt">decimal</span><span class="c1"></span>
<a id="tutorial_en.catala_en-293" name="tutorial_en.catala_en-293"></a><span class="c1"># This structure describes the parameters of a tax computation formula that</span>
<a id="tutorial_en.catala_en-294" name="tutorial_en.catala_en-294"></a><span class="c1"># has two tax brackets, each with their own tax rate.</span>
<a id="tutorial_en.catala_en-295" name="tutorial_en.catala_en-295"></a>
<a id="tutorial_en.catala_en-296" name="tutorial_en.catala_en-296"></a><span class="kd">declaration</span> <span class="kd">scope</span> <span class="nc">TwoBracketsTaxComputation</span> <span class="o">:</span>
<a id="tutorial_en.catala_en-297" name="tutorial_en.catala_en-297"></a>  <span class="kd">input</span> <span class="nv">brackets</span> <span class="kd">content</span> <span class="nc">TwoBrackets</span><span class="c1"></span>
<a id="tutorial_en.catala_en-298" name="tutorial_en.catala_en-298"></a><span class="c1">  # This input variable contains the description of the</span>
<a id="tutorial_en.catala_en-299" name="tutorial_en.catala_en-299"></a><span class="c1">  # parameters of the tax formula.</span>
<a id="tutorial_en.catala_en-300" name="tutorial_en.catala_en-300"></a>  <span class="kd">output</span> <span class="nv">tax_formula</span> <span class="kd">content</span> <span class="kt">money</span> <span class="kd">depends on</span> <span class="kt">money</span><span class="c1"></span>
<a id="tutorial_en.catala_en-301" name="tutorial_en.catala_en-301"></a><span class="c1">  # But for declaring the tax_formula variable, we declare it as</span>
<a id="tutorial_en.catala_en-302" name="tutorial_en.catala_en-302"></a><span class="c1">  # a function: &quot;content money depends on money&quot; means a function that</span>
<a id="tutorial_en.catala_en-303" name="tutorial_en.catala_en-303"></a><span class="c1">  # returns money as output (the tax) and takes money as input (the income).</span>
</pre></div>
</td></tr></table>
</div>

<h3 class='law-heading'><a href='#'>Article 4</a></h3>
<p class='law-text'>The tax amount for a two-brackets computation is equal to the amount
of income in each bracket multiplied by the rate of each bracket.</p>
<div class='code-wrapper'>
<div class='filename'>tutorial_en.catala_en</div>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>
<span class="normal"><a href="#tutorial_en.catala_en-312">312</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-313">313</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-314">314</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-315">315</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-316">316</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-317">317</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-318">318</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-319">319</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-320">320</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-321">321</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-322">322</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-323">323</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-324">324</a></span>
</pre></div></td><td class="code"><div class="highlight"><pre>
<a id="tutorial_en.catala_en-312" name="tutorial_en.catala_en-312"></a><span class="kd">scope</span> <span class="nc">TwoBracketsTaxComputation</span> <span class="o">:</span>
<a id="tutorial_en.catala_en-313" name="tutorial_en.catala_en-313"></a>  <span class="kd">definition</span> <span class="nv">tax_formula</span> <span class="kr">of</span> <span class="nv">income</span> <span class="kd">equals</span><span class="c1"></span>
<a id="tutorial_en.catala_en-314" name="tutorial_en.catala_en-314"></a><span class="c1">    # The money parameter for the &quot;tax_formula&quot; function is introduced as</span>
<a id="tutorial_en.catala_en-315" name="tutorial_en.catala_en-315"></a><span class="c1">    # &quot;income&quot;. The name of the parameter is your choice, and will not impact</span>
<a id="tutorial_en.catala_en-316" name="tutorial_en.catala_en-316"></a><span class="c1">    # things outside this part of the definition. You can choose another</span>
<a id="tutorial_en.catala_en-317" name="tutorial_en.catala_en-317"></a><span class="c1">    # name in another definition of &quot;tax_formula&quot;.</span>
<a id="tutorial_en.catala_en-318" name="tutorial_en.catala_en-318"></a>    <span class="kr">if</span> <span class="nv">income</span> <span class="o">&lt;=$</span> <span class="nv">brackets</span><span class="o">.</span>breakpoint <span class="kr">then</span>
<a id="tutorial_en.catala_en-319" name="tutorial_en.catala_en-319"></a>      <span class="nv">income</span> <span class="o">*$</span> <span class="nv">brackets</span><span class="o">.</span>rate1
<a id="tutorial_en.catala_en-320" name="tutorial_en.catala_en-320"></a>    <span class="kr">else</span> <span class="o">(</span>
<a id="tutorial_en.catala_en-321" name="tutorial_en.catala_en-321"></a>      <span class="nv">brackets</span><span class="o">.</span>breakpoint <span class="o">*$</span> <span class="nv">brackets</span><span class="o">.</span>rate1 <span class="o">+$</span>
<a id="tutorial_en.catala_en-322" name="tutorial_en.catala_en-322"></a>      <span class="o">(</span><span class="nv">income</span> <span class="o">-$</span> <span class="nv">brackets</span><span class="o">.</span>breakpoint<span class="o">)</span> <span class="o">*$</span> <span class="nv">brackets</span><span class="o">.</span>rate2
<a id="tutorial_en.catala_en-323" name="tutorial_en.catala_en-323"></a>    <span class="o">)</span><span class="c1"></span>
<a id="tutorial_en.catala_en-324" name="tutorial_en.catala_en-324"></a><span class="c1">    # This is the formula for implementing a two-bracketstax system.</span>
</pre></div>
</td></tr></table>
</div>

<h2 class='law-heading'><a href='#'>Scope inclusion</a></h2>
<p class='law-text'>Now that we've defined our helper scope for computing a two-brackets tax, we
want to use it in our main tax computation scope. As mentioned before,
Catala's scope can also be thought of as big functions. And these big functions
can call each other, which is what we'll see in the below article.</p>
<h3 class='law-heading'><a href='#'>Article 5</a></h3>
<p class='law-text'>For individuals whose income is greater than $100,000, the income
tax of article 1 is 40% of the income above $100,000. Below $100,000, the
income tax is 20% of the income.</p>
<div class='code-wrapper'>
<div class='filename'>tutorial_en.catala_en</div>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>
<span class="normal"><a href="#tutorial_en.catala_en-341">341</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-342">342</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-343">343</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-344">344</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-345">345</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-346">346</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-347">347</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-348">348</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-349">349</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-350">350</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-351">351</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-352">352</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-353">353</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-354">354</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-355">355</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-356">356</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-357">357</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-358">358</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-359">359</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-360">360</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-361">361</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-362">362</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-363">363</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-364">364</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-365">365</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-366">366</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-367">367</a></span>
</pre></div></td><td class="code"><div class="highlight"><pre>
<a id="tutorial_en.catala_en-341" name="tutorial_en.catala_en-341"></a><span class="kd">declaration</span> <span class="kd">scope</span> <span class="nc">NewIncomeTaxComputation</span><span class="o">:</span>
<a id="tutorial_en.catala_en-342" name="tutorial_en.catala_en-342"></a>  <span class="nv">two_brackets</span> <span class="kd">scope</span> <span class="nc">TwoBracketsTaxComputation</span><span class="c1"></span>
<a id="tutorial_en.catala_en-343" name="tutorial_en.catala_en-343"></a><span class="c1">  # This line says that we add the item two_brackets to the context.</span>
<a id="tutorial_en.catala_en-344" name="tutorial_en.catala_en-344"></a><span class="c1">  # However, the &quot;scope&quot; keyword tells that this item is not a piece of data</span>
<a id="tutorial_en.catala_en-345" name="tutorial_en.catala_en-345"></a><span class="c1">  # but rather a subscope that we can use to compute things.</span>
<a id="tutorial_en.catala_en-346" name="tutorial_en.catala_en-346"></a>  <span class="kd">input</span> <span class="nv">individual</span> <span class="kd">content</span> <span class="nc">Individual</span>
<a id="tutorial_en.catala_en-347" name="tutorial_en.catala_en-347"></a>  <span class="kd">output</span> <span class="nv">income_tax</span> <span class="kd">content</span> <span class="kt">money</span>
<a id="tutorial_en.catala_en-348" name="tutorial_en.catala_en-348"></a>
<a id="tutorial_en.catala_en-349" name="tutorial_en.catala_en-349"></a><span class="kd">scope</span> <span class="nc">NewIncomeTaxComputation</span> <span class="o">:</span><span class="c1"></span>
<a id="tutorial_en.catala_en-350" name="tutorial_en.catala_en-350"></a><span class="c1">  # Since the subscope &quot;two_brackets&quot; is like a big function we can call,</span>
<a id="tutorial_en.catala_en-351" name="tutorial_en.catala_en-351"></a><span class="c1">  # we need to define its arguments. This is done below:</span>
<a id="tutorial_en.catala_en-352" name="tutorial_en.catala_en-352"></a>  <span class="kd">definition</span> <span class="nv">two_brackets</span><span class="o">.</span>brackets <span class="kd">equals</span> <span class="nc">TwoBrackets</span> <span class="o">{</span>
<a id="tutorial_en.catala_en-353" name="tutorial_en.catala_en-353"></a>    <span class="o">--</span> <span class="nv">breakpoint</span><span class="o">:</span> <span class="o">$</span><span class="mi">100,000</span>
<a id="tutorial_en.catala_en-354" name="tutorial_en.catala_en-354"></a>    <span class="o">--</span> <span class="nv">rate1</span><span class="o">:</span> <span class="mi">20</span><span class="o">%</span>
<a id="tutorial_en.catala_en-355" name="tutorial_en.catala_en-355"></a>    <span class="o">--</span> <span class="nv">rate2</span><span class="o">:</span> <span class="mi">40</span><span class="o">%</span>
<a id="tutorial_en.catala_en-356" name="tutorial_en.catala_en-356"></a>  <span class="o">}</span><span class="c1"></span>
<a id="tutorial_en.catala_en-357" name="tutorial_en.catala_en-357"></a><span class="c1">  # By defining the input variable &quot;brackets&quot; of the subscope &quot;two_brackets&quot;,</span>
<a id="tutorial_en.catala_en-358" name="tutorial_en.catala_en-358"></a><span class="c1">  # we have changed how the subscope will execute. The subscope will execute</span>
<a id="tutorial_en.catala_en-359" name="tutorial_en.catala_en-359"></a><span class="c1">  # with all the values defined by the caller, then compute the value</span>
<a id="tutorial_en.catala_en-360" name="tutorial_en.catala_en-360"></a><span class="c1">  # of its other variables.</span>
<a id="tutorial_en.catala_en-361" name="tutorial_en.catala_en-361"></a>
<a id="tutorial_en.catala_en-362" name="tutorial_en.catala_en-362"></a>  <span class="kd">definition</span> <span class="nv">income_tax</span> <span class="kd">equals</span> <span class="nv">two_brackets</span><span class="o">.</span>tax_formula <span class="kr">of</span> <span class="nv">individual</span><span class="o">.</span>income<span class="c1"></span>
<a id="tutorial_en.catala_en-363" name="tutorial_en.catala_en-363"></a><span class="c1">  # After the subscope has executed, you can retrieve results from it. Here,</span>
<a id="tutorial_en.catala_en-364" name="tutorial_en.catala_en-364"></a><span class="c1">  # we retrive the result of variable &quot;tax_formula&quot; of computed by the</span>
<a id="tutorial_en.catala_en-365" name="tutorial_en.catala_en-365"></a><span class="c1">  # subscope &quot;two_brackets&quot;. It&#39;s up yo you to choose what is an input and</span>
<a id="tutorial_en.catala_en-366" name="tutorial_en.catala_en-366"></a><span class="c1">  # an output of your subscope; if you make an inconsistent choice, the</span>
<a id="tutorial_en.catala_en-367" name="tutorial_en.catala_en-367"></a><span class="c1">  # Catala compiler will warn you.</span>
</pre></div>
</td></tr></table>
</div>
<p class='law-text'>Now that we've successfuly defined our income tax computation, the legislator
inevitably comes to disturb our beautiful and regular formulas to add a special
case! The article below is a really common pattern in statutes, and let's
see how Catala handles it.</p>
<h3 class='law-heading'><a href='#'>Article 6</a></h3>
<p class='law-text'>Individuals earning less than $10,000 are exempted of the income tax mentioned
at article 1.</p>
<div class='code-wrapper'>
<div class='filename'>tutorial_en.catala_en</div>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>
<span class="normal"><a href="#tutorial_en.catala_en-381">381</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-382">382</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-383">383</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-384">384</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-385">385</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-386">386</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-387">387</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-388">388</a></span>
</pre></div></td><td class="code"><div class="highlight"><pre>
<a id="tutorial_en.catala_en-381" name="tutorial_en.catala_en-381"></a><span class="kd">scope</span> <span class="nc">NewIncomeTaxComputation</span><span class="o">:</span><span class="c1"></span>
<a id="tutorial_en.catala_en-382" name="tutorial_en.catala_en-382"></a><span class="c1">  # Here, we simply define a new conditional definition for &quot;income tax&quot;</span>
<a id="tutorial_en.catala_en-383" name="tutorial_en.catala_en-383"></a><span class="c1">  # that handles the special case.</span>
<a id="tutorial_en.catala_en-384" name="tutorial_en.catala_en-384"></a>  <span class="kd">definition</span> <span class="nv">income_tax</span> <span class="kd">under condition</span>
<a id="tutorial_en.catala_en-385" name="tutorial_en.catala_en-385"></a>    <span class="nv">individual</span><span class="o">.</span>income <span class="o">&lt;=$</span> <span class="o">$</span><span class="mi">10,000</span>
<a id="tutorial_en.catala_en-386" name="tutorial_en.catala_en-386"></a>  <span class="kd">consequence</span> <span class="kd">equals</span> <span class="o">$</span><span class="mi">0</span><span class="c1"></span>
<a id="tutorial_en.catala_en-387" name="tutorial_en.catala_en-387"></a><span class="c1">  # What, you think something might be wrong with this? Hmmm... We&#39;ll see</span>
<a id="tutorial_en.catala_en-388" name="tutorial_en.catala_en-388"></a><span class="c1">  # later!</span>
</pre></div>
</td></tr></table>
</div>
<p class='law-text'>That's it! We've defined a two-brackets tax computation with a special case
simply by annotating legislative article by snippets of Catala code.
However, attentive readers may have caught something weird in the Catala
translation of articles 5 and 6. What happens when the income of the individual
is lesser than $10,000? Right now, the two definitions at articles 5 and 6
for income_tax apply, and they're in conflict.<br/>
This is a flaw in the Catala translation, but the language can help you
find this sort of errors via simple testing or
even formal verification. Let's start with the testing.</p>
<h2 class='law-heading'><a href='#'>Testing Catala programs</a></h2>
<p class='law-text'>Testing Catala programs can be done directly into Catala. Indeed, writing test
cases for each Catala scope that you define is a good practice called
"unit testing" in the software engineering community. A test case is defined
as another scope:</p>
<h3 class='law-heading'><a href='#'>Testing NewIncomeTaxComputation</a></h3>

<div class='code-wrapper'>
<div class='filename'>tutorial_en.catala_en</div>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>
<span class="normal"><a href="#tutorial_en.catala_en-412">412</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-413">413</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-414">414</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-415">415</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-416">416</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-417">417</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-418">418</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-419">419</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-420">420</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-421">421</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-422">422</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-423">423</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-424">424</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-425">425</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-426">426</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-427">427</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-428">428</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-429">429</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-430">430</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-431">431</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-432">432</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-433">433</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-434">434</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-435">435</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-436">436</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-437">437</a></span>
</pre></div></td><td class="code"><div class="highlight"><pre>
<a id="tutorial_en.catala_en-412" name="tutorial_en.catala_en-412"></a><span class="kd">declaration</span> <span class="kd">scope</span> <span class="nc">Test1</span><span class="o">:</span><span class="c1"></span>
<a id="tutorial_en.catala_en-413" name="tutorial_en.catala_en-413"></a><span class="c1">  # We include the scope to tax as a subscope.</span>
<a id="tutorial_en.catala_en-414" name="tutorial_en.catala_en-414"></a>  <span class="nv">tax_computation</span> <span class="kd">scope</span> <span class="nc">NewIncomeTaxComputation</span>
<a id="tutorial_en.catala_en-415" name="tutorial_en.catala_en-415"></a>  <span class="kd">output</span> <span class="nv">income_tax</span> <span class="kd">content</span> <span class="kt">money</span><span class="c1"></span>
<a id="tutorial_en.catala_en-416" name="tutorial_en.catala_en-416"></a>
<a id="tutorial_en.catala_en-417" name="tutorial_en.catala_en-417"></a><span class="c1"># To execute that test, assuming that the Catala compiler can be called</span>
<a id="tutorial_en.catala_en-418" name="tutorial_en.catala_en-418"></a><span class="c1"># with &quot;catala&quot;, enter the following command:</span>
<a id="tutorial_en.catala_en-419" name="tutorial_en.catala_en-419"></a><span class="c1">#     catala Interpret --scope=Test1 tutorial_en.catala_en</span>
<a id="tutorial_en.catala_en-420" name="tutorial_en.catala_en-420"></a>
<a id="tutorial_en.catala_en-421" name="tutorial_en.catala_en-421"></a><span class="kd">scope</span> <span class="nc">Test1</span><span class="o">:</span>
<a id="tutorial_en.catala_en-422" name="tutorial_en.catala_en-422"></a>  <span class="kd">definition</span>
<a id="tutorial_en.catala_en-423" name="tutorial_en.catala_en-423"></a>    <span class="nv">tax_computation</span><span class="o">.</span>individual<span class="c1"></span>
<a id="tutorial_en.catala_en-424" name="tutorial_en.catala_en-424"></a><span class="c1">    # We define the argument to the subscope</span>
<a id="tutorial_en.catala_en-425" name="tutorial_en.catala_en-425"></a>  <span class="kd">equals</span><span class="c1"></span>
<a id="tutorial_en.catala_en-426" name="tutorial_en.catala_en-426"></a><span class="c1">    # The four lines below define a whole structure by giving a value to</span>
<a id="tutorial_en.catala_en-427" name="tutorial_en.catala_en-427"></a><span class="c1">    # each of its fields</span>
<a id="tutorial_en.catala_en-428" name="tutorial_en.catala_en-428"></a>    <span class="nc">Individual</span> <span class="o">{</span>
<a id="tutorial_en.catala_en-429" name="tutorial_en.catala_en-429"></a>      <span class="o">--</span> <span class="nv">income</span><span class="o">:</span> <span class="o">$</span><span class="mi">230,000</span>
<a id="tutorial_en.catala_en-430" name="tutorial_en.catala_en-430"></a>      <span class="o">--</span> <span class="nv">number_of_children</span><span class="o">:</span> <span class="mi">0</span>
<a id="tutorial_en.catala_en-431" name="tutorial_en.catala_en-431"></a>    <span class="o">}</span>
<a id="tutorial_en.catala_en-432" name="tutorial_en.catala_en-432"></a>
<a id="tutorial_en.catala_en-433" name="tutorial_en.catala_en-433"></a>  <span class="kd">definition</span> <span class="nv">income_tax</span> <span class="kd">equals</span> <span class="nv">tax_computation</span><span class="o">.</span>income_tax<span class="c1"></span>
<a id="tutorial_en.catala_en-434" name="tutorial_en.catala_en-434"></a><span class="c1">  # Next, we retrieve the income tax value compute it by the subscope and</span>
<a id="tutorial_en.catala_en-435" name="tutorial_en.catala_en-435"></a><span class="c1">  # assert that it is equal to the expected value :</span>
<a id="tutorial_en.catala_en-436" name="tutorial_en.catala_en-436"></a><span class="c1">  # ($230,000-$100,00)*40%+$100,000*20% = $72,000</span>
<a id="tutorial_en.catala_en-437" name="tutorial_en.catala_en-437"></a>  <span class="kd">assertion</span> <span class="nv">income_tax</span> <span class="o">=</span> <span class="o">$</span><span class="mi">72,000</span>
</pre></div>
</td></tr></table>
</div>
<p class='law-text'>This test should pass. Let us now consider a failing test case:</p>
<div class='code-wrapper'>
<div class='filename'>tutorial_en.catala_en</div>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>
<span class="normal"><a href="#tutorial_en.catala_en-443">443</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-444">444</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-445">445</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-446">446</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-447">447</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-448">448</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-449">449</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-450">450</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-451">451</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-452">452</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-453">453</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-454">454</a></span>
</pre></div></td><td class="code"><div class="highlight"><pre>
<a id="tutorial_en.catala_en-443" name="tutorial_en.catala_en-443"></a><span class="kd">declaration</span> <span class="kd">scope</span> <span class="nc">Test2</span><span class="o">:</span>
<a id="tutorial_en.catala_en-444" name="tutorial_en.catala_en-444"></a>  <span class="nv">tax_computation</span> <span class="kd">scope</span> <span class="nc">NewIncomeTaxComputation</span>
<a id="tutorial_en.catala_en-445" name="tutorial_en.catala_en-445"></a>  <span class="kd">output</span> <span class="nv">income_tax</span> <span class="kd">content</span> <span class="kt">money</span>
<a id="tutorial_en.catala_en-446" name="tutorial_en.catala_en-446"></a>
<a id="tutorial_en.catala_en-447" name="tutorial_en.catala_en-447"></a><span class="kd">scope</span> <span class="nc">Test2</span><span class="o">:</span>
<a id="tutorial_en.catala_en-448" name="tutorial_en.catala_en-448"></a>  <span class="kd">definition</span> <span class="nv">tax_computation</span><span class="o">.</span>individual <span class="kd">equals</span> <span class="nc">Individual</span> <span class="o">{</span>
<a id="tutorial_en.catala_en-449" name="tutorial_en.catala_en-449"></a>    <span class="o">--</span> <span class="nv">income</span><span class="o">:</span> <span class="o">$</span><span class="mi">4,000</span>
<a id="tutorial_en.catala_en-450" name="tutorial_en.catala_en-450"></a>    <span class="o">--</span> <span class="nv">number_of_children</span><span class="o">:</span> <span class="mi">0</span>
<a id="tutorial_en.catala_en-451" name="tutorial_en.catala_en-451"></a>  <span class="o">}</span>
<a id="tutorial_en.catala_en-452" name="tutorial_en.catala_en-452"></a>
<a id="tutorial_en.catala_en-453" name="tutorial_en.catala_en-453"></a>  <span class="kd">definition</span> <span class="nv">income_tax</span> <span class="kd">equals</span> <span class="nv">tax_computation</span><span class="o">.</span>income_tax
<a id="tutorial_en.catala_en-454" name="tutorial_en.catala_en-454"></a>  <span class="kd">assertion</span> <span class="nv">income_tax</span> <span class="o">=</span> <span class="o">$</span><span class="mi">0</span>
</pre></div>
</td></tr></table>
</div>
<p class='law-text'>This test case should compute a $0 income tax because of Article 6. But instead,
execution will yield an error saying that there is a conflict between rules.</p>
<h2 class='law-heading'><a href='#'>Defining exceptions to rules</a></h2>
<p class='law-text'>Indeed, the definition of the income tax in article 6 conflicts with the
definition of income tax in article 5. But actually, article 6 is just an
exception of article 5. In the law, it is implicit that if article 6 is
applicable, then it takes precedence over article 5.</p>
<h3 class='law-heading'><a href='#'>Fixing the computation</a></h3>
<p class='law-text'>This implicit precedence has to be explicitly declared in Catala. Here is a
fixed version of the NewIncomeTaxComputation scope:</p>
<div class='code-wrapper'>
<div class='filename'>tutorial_en.catala_en</div>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>
<span class="normal"><a href="#tutorial_en.catala_en-473">473</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-474">474</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-475">475</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-476">476</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-477">477</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-478">478</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-479">479</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-480">480</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-481">481</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-482">482</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-483">483</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-484">484</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-485">485</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-486">486</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-487">487</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-488">488</a></span>
</pre></div></td><td class="code"><div class="highlight"><pre>
<a id="tutorial_en.catala_en-473" name="tutorial_en.catala_en-473"></a><span class="kd">declaration</span> <span class="kd">scope</span> <span class="nc">NewIncomeTaxComputationFixed</span><span class="o">:</span>
<a id="tutorial_en.catala_en-474" name="tutorial_en.catala_en-474"></a>  <span class="nv">two_brackets</span> <span class="kd">scope</span> <span class="nc">TwoBracketsTaxComputation</span>
<a id="tutorial_en.catala_en-475" name="tutorial_en.catala_en-475"></a>  <span class="kd">input</span> <span class="nv">individual</span> <span class="kd">content</span> <span class="nc">Individual</span>
<a id="tutorial_en.catala_en-476" name="tutorial_en.catala_en-476"></a>  <span class="kd">output</span> <span class="nv">tax_formula</span> <span class="kd">content</span> <span class="kt">money</span> <span class="kd">depends on</span> <span class="kt">money</span>
<a id="tutorial_en.catala_en-477" name="tutorial_en.catala_en-477"></a>  <span class="kd">context</span> <span class="kd">output</span> <span class="nv">income_tax</span> <span class="kd">content</span> <span class="kt">money</span><span class="c1"></span>
<a id="tutorial_en.catala_en-478" name="tutorial_en.catala_en-478"></a><span class="c1">  # This variable is tagged with &quot;context&quot;, a new concept which we have not</span>
<a id="tutorial_en.catala_en-479" name="tutorial_en.catala_en-479"></a><span class="c1">  # introduced yet. For now, ignore it as we&#39;ll come back to it in the section</span>
<a id="tutorial_en.catala_en-480" name="tutorial_en.catala_en-480"></a><span class="c1">  # &quot;Context scope variables&quot;.</span>
<a id="tutorial_en.catala_en-481" name="tutorial_en.catala_en-481"></a>
<a id="tutorial_en.catala_en-482" name="tutorial_en.catala_en-482"></a><span class="kd">scope</span> <span class="nc">NewIncomeTaxComputationFixed</span> <span class="o">:</span>
<a id="tutorial_en.catala_en-483" name="tutorial_en.catala_en-483"></a>  <span class="kd">definition</span> <span class="nv">two_brackets</span><span class="o">.</span>brackets <span class="kd">equals</span> <span class="nc">TwoBrackets</span> <span class="o">{</span>
<a id="tutorial_en.catala_en-484" name="tutorial_en.catala_en-484"></a>    <span class="o">--</span> <span class="nv">breakpoint</span><span class="o">:</span> <span class="o">$</span><span class="mi">100,000</span>
<a id="tutorial_en.catala_en-485" name="tutorial_en.catala_en-485"></a>    <span class="o">--</span> <span class="nv">rate1</span><span class="o">:</span> <span class="mi">20</span><span class="o">%</span>
<a id="tutorial_en.catala_en-486" name="tutorial_en.catala_en-486"></a>    <span class="o">--</span> <span class="nv">rate2</span><span class="o">:</span> <span class="mi">40</span><span class="o">%</span>
<a id="tutorial_en.catala_en-487" name="tutorial_en.catala_en-487"></a>  <span class="o">}</span>
<a id="tutorial_en.catala_en-488" name="tutorial_en.catala_en-488"></a>  <span class="kd">definition</span> <span class="nv">tax_formula</span> <span class="kr">of</span> <span class="nv">income</span> <span class="kd">equals</span> <span class="nv">two_brackets</span><span class="o">.</span>tax_formula <span class="kr">of</span> <span class="nv">income</span>
</pre></div>
</td></tr></table>
</div>
<p class='law-text'>To define an exception to a rule, you have to first label the rule that
you want to attach the exception to. You can put any snake_case identifier
for the label:</p>
<div class='code-wrapper'>
<div class='filename'>tutorial_en.catala_en</div>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>
<span class="normal"><a href="#tutorial_en.catala_en-496">496</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-497">497</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-498">498</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-499">499</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-500">500</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-501">501</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-502">502</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-503">503</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-504">504</a></span>
</pre></div></td><td class="code"><div class="highlight"><pre>
<a id="tutorial_en.catala_en-496" name="tutorial_en.catala_en-496"></a><span class="kd">scope</span> <span class="nc">NewIncomeTaxComputationFixed</span><span class="o">:</span>
<a id="tutorial_en.catala_en-497" name="tutorial_en.catala_en-497"></a>  <span class="kd">label</span> <span class="nv">article_5</span>
<a id="tutorial_en.catala_en-498" name="tutorial_en.catala_en-498"></a>  <span class="kd">definition</span> <span class="nv">income_tax</span> <span class="kd">equals</span> <span class="nv">two_brackets</span><span class="o">.</span>tax_formula <span class="kr">of</span> <span class="nv">individual</span><span class="o">.</span>income<span class="c1"></span>
<a id="tutorial_en.catala_en-499" name="tutorial_en.catala_en-499"></a>
<a id="tutorial_en.catala_en-500" name="tutorial_en.catala_en-500"></a><span class="c1">  # Then, you can declare the exception by referring back to the label</span>
<a id="tutorial_en.catala_en-501" name="tutorial_en.catala_en-501"></a>  <span class="kd">exception</span> <span class="nv">article_5</span>
<a id="tutorial_en.catala_en-502" name="tutorial_en.catala_en-502"></a>  <span class="kd">definition</span> <span class="nv">income_tax</span> <span class="kd">under condition</span>
<a id="tutorial_en.catala_en-503" name="tutorial_en.catala_en-503"></a>    <span class="nv">individual</span><span class="o">.</span>income <span class="o">&lt;=$</span> <span class="o">$</span><span class="mi">10,000</span>
<a id="tutorial_en.catala_en-504" name="tutorial_en.catala_en-504"></a>  <span class="kd">consequence</span> <span class="kd">equals</span> <span class="o">$</span><span class="mi">0</span>
</pre></div>
</td></tr></table>
</div>
<p class='law-text'>And the test that should now work:</p>
<div class='code-wrapper'>
<div class='filename'>tutorial_en.catala_en</div>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>
<span class="normal"><a href="#tutorial_en.catala_en-510">510</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-511">511</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-512">512</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-513">513</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-514">514</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-515">515</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-516">516</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-517">517</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-518">518</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-519">519</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-520">520</a></span>
</pre></div></td><td class="code"><div class="highlight"><pre>
<a id="tutorial_en.catala_en-510" name="tutorial_en.catala_en-510"></a><span class="kd">declaration</span> <span class="kd">scope</span> <span class="nc">Test3</span><span class="o">:</span>
<a id="tutorial_en.catala_en-511" name="tutorial_en.catala_en-511"></a>  <span class="nv">tax_computation</span> <span class="kd">scope</span> <span class="nc">NewIncomeTaxComputationFixed</span>
<a id="tutorial_en.catala_en-512" name="tutorial_en.catala_en-512"></a>  <span class="kd">output</span> <span class="nv">income_tax</span> <span class="kd">content</span> <span class="kt">money</span>
<a id="tutorial_en.catala_en-513" name="tutorial_en.catala_en-513"></a>
<a id="tutorial_en.catala_en-514" name="tutorial_en.catala_en-514"></a><span class="kd">scope</span> <span class="nc">Test3</span><span class="o">:</span>
<a id="tutorial_en.catala_en-515" name="tutorial_en.catala_en-515"></a>  <span class="kd">definition</span> <span class="nv">tax_computation</span><span class="o">.</span>individual <span class="kd">equals</span> <span class="nc">Individual</span> <span class="o">{</span>
<a id="tutorial_en.catala_en-516" name="tutorial_en.catala_en-516"></a>    <span class="o">--</span> <span class="nv">income</span><span class="o">:</span> <span class="o">$</span><span class="mi">4,000</span>
<a id="tutorial_en.catala_en-517" name="tutorial_en.catala_en-517"></a>    <span class="o">--</span> <span class="nv">number_of_children</span><span class="o">:</span> <span class="mi">0</span>
<a id="tutorial_en.catala_en-518" name="tutorial_en.catala_en-518"></a>  <span class="o">}</span>
<a id="tutorial_en.catala_en-519" name="tutorial_en.catala_en-519"></a>  <span class="kd">definition</span> <span class="nv">income_tax</span> <span class="kd">equals</span> <span class="nv">tax_computation</span><span class="o">.</span>income_tax
<a id="tutorial_en.catala_en-520" name="tutorial_en.catala_en-520"></a>  <span class="kd">assertion</span> <span class="nv">income_tax</span> <span class="o">=</span> <span class="o">$</span><span class="mi">0</span>
</pre></div>
</td></tr></table>
</div>

<h3 class='law-heading'><a href='#'>Defining exceptions to groups of rules</a></h3>
<p class='law-text'>Note that the label system also lets you define more complicated exceptions
patterns. Sometimes, you want to declare an exception to a group of
piecewise definitions. To do that, simply use the same label for all
the piecewise definitions.</p>
<h2 class='law-heading'><a href='#'>Context scope variables</a></h2>
<p class='law-text'>With its "input","output" and "internal" variables, Catala's scope are close
to regular functions with arguments, local variables and output. However, the
law can sometimes be adversarial to good programming practices and define
provisions that break the abstraction barrier normally associated to a function.<br/>
This can be the case when an outside body of legislative text "reuses" a
a legal concept but adding a twist on it. Consider the following fictionnal
(but not quite pathological computational-wise) example.</p>
<h3 class='law-heading'><a href='#'>Article 7</a></h3>
<p class='law-text'>The justice system delivers fines to individuals when they committed an offense.
The fines are determined based on the amount of taxes paid by the individual.
The more taxes the invidual pays, the higher the fine. However, the determination
of the amount of taxes paid by an individual in this context shall include
a flat tax fee of $500 for individuals earning less than $10,000.</p>
<div class='code-wrapper'>
<div class='filename'>tutorial_en.catala_en</div>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>
<span class="normal"><a href="#tutorial_en.catala_en-551">551</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-552">552</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-553">553</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-554">554</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-555">555</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-556">556</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-557">557</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-558">558</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-559">559</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-560">560</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-561">561</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-562">562</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-563">563</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-564">564</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-565">565</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-566">566</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-567">567</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-568">568</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-569">569</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-570">570</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-571">571</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-572">572</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-573">573</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-574">574</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-575">575</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-576">576</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-577">577</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-578">578</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-579">579</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-580">580</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-581">581</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-582">582</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-583">583</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-584">584</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-585">585</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-586">586</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-587">587</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-588">588</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-589">589</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-590">590</a></span>
</pre></div></td><td class="code"><div class="highlight"><pre>
<a id="tutorial_en.catala_en-551" name="tutorial_en.catala_en-551"></a><span class="c1"># To compute the basis determined for issuing the fines, we create a new scope.</span>
<a id="tutorial_en.catala_en-552" name="tutorial_en.catala_en-552"></a><span class="kd">declaration</span> <span class="kd">scope</span> <span class="nc">BasisForFineDetermination</span><span class="o">:</span>
<a id="tutorial_en.catala_en-553" name="tutorial_en.catala_en-553"></a>  <span class="nv">tax_computation</span> <span class="kd">scope</span> <span class="nc">NewIncomeTaxComputationFixed</span><span class="c1"></span>
<a id="tutorial_en.catala_en-554" name="tutorial_en.catala_en-554"></a><span class="c1">  # This scope will call the NewIncomeTaxComputationFixed scope that defines</span>
<a id="tutorial_en.catala_en-555" name="tutorial_en.catala_en-555"></a><span class="c1">  # the proper tax computation.</span>
<a id="tutorial_en.catala_en-556" name="tutorial_en.catala_en-556"></a>  <span class="kd">input</span> <span class="nv">individual</span> <span class="kd">content</span> <span class="nc">Individual</span>
<a id="tutorial_en.catala_en-557" name="tutorial_en.catala_en-557"></a>  <span class="kd">output</span> <span class="nv">basis_for_fine</span> <span class="kd">content</span> <span class="kt">money</span>
<a id="tutorial_en.catala_en-558" name="tutorial_en.catala_en-558"></a>
<a id="tutorial_en.catala_en-559" name="tutorial_en.catala_en-559"></a><span class="kd">scope</span> <span class="nc">BasisForFineDetermination</span> <span class="o">:</span><span class="c1"></span>
<a id="tutorial_en.catala_en-560" name="tutorial_en.catala_en-560"></a><span class="c1">  # First, we link the inputs and outputs of the two scopes.</span>
<a id="tutorial_en.catala_en-561" name="tutorial_en.catala_en-561"></a>  <span class="kd">definition</span> <span class="nv">tax_computation</span><span class="o">.</span>individual <span class="kd">equals</span> <span class="nv">individual</span>
<a id="tutorial_en.catala_en-562" name="tutorial_en.catala_en-562"></a>  <span class="kd">definition</span> <span class="nv">basis_for_fine</span> <span class="kd">equals</span> <span class="nv">tax_computation</span><span class="o">.</span>income_tax<span class="c1"></span>
<a id="tutorial_en.catala_en-563" name="tutorial_en.catala_en-563"></a>
<a id="tutorial_en.catala_en-564" name="tutorial_en.catala_en-564"></a><span class="c1">  # But then, how to account for the provision of the law that reverts the</span>
<a id="tutorial_en.catala_en-565" name="tutorial_en.catala_en-565"></a><span class="c1">  # mechanism canceling taxes for individuals earning less than $10,000 dollars?</span>
<a id="tutorial_en.catala_en-566" name="tutorial_en.catala_en-566"></a>
<a id="tutorial_en.catala_en-567" name="tutorial_en.catala_en-567"></a><span class="c1">  # This is where the &quot;context&quot; concept comes into play. Indeed, we had annotated</span>
<a id="tutorial_en.catala_en-568" name="tutorial_en.catala_en-568"></a><span class="c1">  # the &quot;income_tax&quot; variable of &quot;NewIncomeTaxComputationFixed&quot; with the</span>
<a id="tutorial_en.catala_en-569" name="tutorial_en.catala_en-569"></a><span class="c1">  # &quot;context&quot; attribute. &quot;context&quot; is a variant of &quot;input&quot; that exposes the</span>
<a id="tutorial_en.catala_en-570" name="tutorial_en.catala_en-570"></a><span class="c1">  # variable as an input of the scope. However, it is more permissive than</span>
<a id="tutorial_en.catala_en-571" name="tutorial_en.catala_en-571"></a><span class="c1">  # &quot;input&quot; because it lets you re-define the &quot;context&quot; variable inside its</span>
<a id="tutorial_en.catala_en-572" name="tutorial_en.catala_en-572"></a><span class="c1">  # own scope. Then, you&#39;re faced with a choice for the value of &quot;income_tax&quot;:</span>
<a id="tutorial_en.catala_en-573" name="tutorial_en.catala_en-573"></a><span class="c1">  # do you take the value coming from its definition inside</span>
<a id="tutorial_en.catala_en-574" name="tutorial_en.catala_en-574"></a><span class="c1">  # &quot;NewIncomeTaxComputationFixed&quot; or do you take the value coming from the</span>
<a id="tutorial_en.catala_en-575" name="tutorial_en.catala_en-575"></a><span class="c1">  # input of the scope? This dilemma is resolved in two ways. First, by looking</span>
<a id="tutorial_en.catala_en-576" name="tutorial_en.catala_en-576"></a><span class="c1">  # at the conditions of the definitions: only definitions that have a condition</span>
<a id="tutorial_en.catala_en-577" name="tutorial_en.catala_en-577"></a><span class="c1">  # evaluating to &quot;true&quot; at runtime will be considered. If there&#39;s only one,</span>
<a id="tutorial_en.catala_en-578" name="tutorial_en.catala_en-578"></a><span class="c1">  # the pick is easy. But what if two definitions trigger at the same time,</span>
<a id="tutorial_en.catala_en-579" name="tutorial_en.catala_en-579"></a><span class="c1">  # one from the input and one from the &quot;NewIncomeTaxComputationFixed&quot; scope?</span>
<a id="tutorial_en.catala_en-580" name="tutorial_en.catala_en-580"></a><span class="c1">  # Well, second, in that case we always prioritize the input definition for</span>
<a id="tutorial_en.catala_en-581" name="tutorial_en.catala_en-581"></a><span class="c1">  # picking. In Catala, the caller scope has priority over the callee scope</span>
<a id="tutorial_en.catala_en-582" name="tutorial_en.catala_en-582"></a><span class="c1">  # for &quot;context&quot; variable. It&#39;s as if the caller provided an extra exception</span>
<a id="tutorial_en.catala_en-583" name="tutorial_en.catala_en-583"></a><span class="c1">  # for the definition of the scope variable.</span>
<a id="tutorial_en.catala_en-584" name="tutorial_en.catala_en-584"></a>
<a id="tutorial_en.catala_en-585" name="tutorial_en.catala_en-585"></a><span class="c1">  # Back to our little problem, the solution is here to provide from the outside</span>
<a id="tutorial_en.catala_en-586" name="tutorial_en.catala_en-586"></a><span class="c1">  # an exceptional definition for income tax for people earning less than</span>
<a id="tutorial_en.catala_en-587" name="tutorial_en.catala_en-587"></a><span class="c1">  # $10,0000.</span>
<a id="tutorial_en.catala_en-588" name="tutorial_en.catala_en-588"></a>  <span class="kd">definition</span> <span class="nv">tax_computation</span><span class="o">.</span>income_tax <span class="kd">under condition</span>
<a id="tutorial_en.catala_en-589" name="tutorial_en.catala_en-589"></a>    <span class="nv">individual</span><span class="o">.</span>income <span class="o">&lt;=$</span> <span class="o">$</span><span class="mi">10,000</span>
<a id="tutorial_en.catala_en-590" name="tutorial_en.catala_en-590"></a>  <span class="kd">consequence</span> <span class="kd">equals</span> <span class="o">$</span><span class="mi">500</span>
</pre></div>
</td></tr></table>
</div>

<h2 class='law-heading'><a href='#'>One variable, multiple states</a></h2>
<p class='law-text'>When a quantity is mentioned it the law, it does not always maps exactly to
an unique Catala variable. More precisely, it often happens that the law defines
an unique quantity with multiple computation steps, each new one building on the
previous one. Here is an example of such a setup and how to deal with it thanks
to a dedicated Catala feature.<br/>
Under the hood, the different states of a Catala variable are implemented by
distinct variables inside the lower intermediate representations of the
language.</p>
<h3 class='law-heading'><a href='#'>Article 8</a></h3>
<p class='law-text'>For taxation purposes, the values of the building operated for charity
purposes can be deducted from the wealth of the individual, which is then
capped at $2,500,000.</p>
<div class='code-wrapper'>
<div class='filename'>tutorial_en.catala_en</div>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>
<span class="normal"><a href="#tutorial_en.catala_en-611">611</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-612">612</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-613">613</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-614">614</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-615">615</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-616">616</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-617">617</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-618">618</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-619">619</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-620">620</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-621">621</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-622">622</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-623">623</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-624">624</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-625">625</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-626">626</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-627">627</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-628">628</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-629">629</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-630">630</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-631">631</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-632">632</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-633">633</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-634">634</a></span>
</pre></div></td><td class="code"><div class="highlight"><pre>
<a id="tutorial_en.catala_en-611" name="tutorial_en.catala_en-611"></a><span class="kd">declaration</span> <span class="kd">scope</span> <span class="nc">WealthTax</span><span class="o">:</span>
<a id="tutorial_en.catala_en-612" name="tutorial_en.catala_en-612"></a>  <span class="kd">input</span> <span class="nv">value_of_buildings_used_for_charity</span> <span class="kd">content</span> <span class="kt">money</span>
<a id="tutorial_en.catala_en-613" name="tutorial_en.catala_en-613"></a>  <span class="kd">input</span> <span class="nv">total_wealth</span> <span class="kd">content</span> <span class="kt">money</span>
<a id="tutorial_en.catala_en-614" name="tutorial_en.catala_en-614"></a>  <span class="kd">internal</span> <span class="nv">wealth</span> <span class="kd">content</span> <span class="kt">money</span><span class="c1"></span>
<a id="tutorial_en.catala_en-615" name="tutorial_en.catala_en-615"></a><span class="c1">    # After the type of the variable, we can define the ordered list of states</span>
<a id="tutorial_en.catala_en-616" name="tutorial_en.catala_en-616"></a><span class="c1">    # that the variable shall take before computing its final value. In each</span>
<a id="tutorial_en.catala_en-617" name="tutorial_en.catala_en-617"></a><span class="c1">    # state, we&#39;ll be able to refer to the value of the previous state.</span>
<a id="tutorial_en.catala_en-618" name="tutorial_en.catala_en-618"></a>    <span class="kd">state</span> <span class="nv">total</span>
<a id="tutorial_en.catala_en-619" name="tutorial_en.catala_en-619"></a>    <span class="kd">state</span> <span class="nv">after_charity_deductions</span>
<a id="tutorial_en.catala_en-620" name="tutorial_en.catala_en-620"></a>    <span class="kd">state</span> <span class="nv">after_capping</span>
<a id="tutorial_en.catala_en-621" name="tutorial_en.catala_en-621"></a>
<a id="tutorial_en.catala_en-622" name="tutorial_en.catala_en-622"></a><span class="kd">scope</span> <span class="nc">WealthTax</span><span class="o">:</span>
<a id="tutorial_en.catala_en-623" name="tutorial_en.catala_en-623"></a>  <span class="kd">definition</span> <span class="nv">wealth</span> <span class="kd">state</span> <span class="nv">total</span> <span class="kd">equals</span> <span class="nv">total_wealth</span>
<a id="tutorial_en.catala_en-624" name="tutorial_en.catala_en-624"></a>  <span class="kd">definition</span> <span class="nv">wealth</span> <span class="kd">state</span> <span class="nv">after_charity_deductions</span> <span class="kd">equals</span>
<a id="tutorial_en.catala_en-625" name="tutorial_en.catala_en-625"></a>    <span class="nv">wealth</span> <span class="o">-$</span><span class="c1"> # Here, &quot;wealth&quot; refers to the state &quot;total&quot;</span>
<a id="tutorial_en.catala_en-626" name="tutorial_en.catala_en-626"></a>      <span class="nv">value_of_buildings_used_for_charity</span>
<a id="tutorial_en.catala_en-627" name="tutorial_en.catala_en-627"></a>  <span class="kd">definition</span> <span class="nv">wealth</span> <span class="kd">state</span> <span class="nv">after_capping</span> <span class="kd">equals</span>
<a id="tutorial_en.catala_en-628" name="tutorial_en.catala_en-628"></a>    <span class="kr">if</span> <span class="nv">wealth</span> <span class="o">&gt;=$</span> <span class="o">$</span><span class="mi">2,500,000</span> <span class="kr">then</span> <span class="o">$</span><span class="mi">2,500,000</span> <span class="kr">else</span> <span class="nv">wealth</span><span class="c1"></span>
<a id="tutorial_en.catala_en-629" name="tutorial_en.catala_en-629"></a><span class="c1">    # Here, &quot;wealth&quot; refers to the state &quot;after_charity_decuctions&quot;</span>
<a id="tutorial_en.catala_en-630" name="tutorial_en.catala_en-630"></a>
<a id="tutorial_en.catala_en-631" name="tutorial_en.catala_en-631"></a>  <span class="kd">assertion</span> <span class="nv">wealth</span> <span class="o">&gt;$</span> <span class="o">$</span><span class="mi">0</span><span class="c1"></span>
<a id="tutorial_en.catala_en-632" name="tutorial_en.catala_en-632"></a><span class="c1">  # Outside of the definition of &quot;wealth&quot;, &quot;wealth&quot; always refer to the final</span>
<a id="tutorial_en.catala_en-633" name="tutorial_en.catala_en-633"></a><span class="c1">  # state of the variable, here &quot;after_capping&quot;.</span>
<a id="tutorial_en.catala_en-634" name="tutorial_en.catala_en-634"></a>
</pre></div>
</td></tr></table>
</div>

<h2 class='law-heading'><a href='#'>Catala values</a></h2>
<p class='law-text'>So far, this tutorial has introduced you to the basic structure of Catala
programs with scope, definitions and exceptions. But to be able to handle
most statutes, Catala comes with support for the usual types of values
on which legislative computations operate.</p>
<h3 class='law-heading'><a href='#'>Booleans</a></h3>
<p class='law-text'>Booleans are the most basic type of value in Catala: they can be either true
or false. Conditions are simply booleans with a default value of false,
see the section about conditions above.</p>
<div class='code-wrapper'>
<div class='filename'>tutorial_en.catala_en</div>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>
<span class="normal"><a href="#tutorial_en.catala_en-651">651</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-652">652</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-653">653</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-654">654</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-655">655</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-656">656</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-657">657</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-658">658</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-659">659</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-660">660</a></span>
</pre></div></td><td class="code"><div class="highlight"><pre>
<a id="tutorial_en.catala_en-651" name="tutorial_en.catala_en-651"></a><span class="kd">declaration</span> <span class="kd">scope</span> <span class="nc">BooleanValues</span><span class="o">:</span>
<a id="tutorial_en.catala_en-652" name="tutorial_en.catala_en-652"></a>  <span class="kd">internal</span> <span class="nv">value1</span> <span class="kd">condition</span>
<a id="tutorial_en.catala_en-653" name="tutorial_en.catala_en-653"></a>  <span class="kd">internal</span> <span class="nv">value2</span> <span class="kd">content</span> <span class="kt">boolean</span>
<a id="tutorial_en.catala_en-654" name="tutorial_en.catala_en-654"></a>
<a id="tutorial_en.catala_en-655" name="tutorial_en.catala_en-655"></a><span class="kd">scope</span> <span class="nc">BooleanValues</span><span class="o">:</span>
<a id="tutorial_en.catala_en-656" name="tutorial_en.catala_en-656"></a>  <span class="kd">rule</span> <span class="nv">value1</span> <span class="kd">under condition</span> <span class="kc">false</span> <span class="o">and</span> <span class="kc">true</span> <span class="kd">consequence</span> <span class="kd">fulfilled</span><span class="c1"></span>
<a id="tutorial_en.catala_en-657" name="tutorial_en.catala_en-657"></a><span class="c1">  # Sets the boolean of the value1 condition to &quot;true&quot; under condition</span>
<a id="tutorial_en.catala_en-658" name="tutorial_en.catala_en-658"></a><span class="c1">  # &quot;false and true&quot;</span>
<a id="tutorial_en.catala_en-659" name="tutorial_en.catala_en-659"></a>  <span class="kd">definition</span> <span class="nv">value2</span> <span class="kd">equals</span> <span class="nv">value1</span> <span class="o">xor</span> <span class="o">(</span><span class="nv">value1</span> <span class="o">and</span> <span class="kc">true</span><span class="o">)</span> <span class="o">=</span> <span class="kc">false</span><span class="c1"></span>
<a id="tutorial_en.catala_en-660" name="tutorial_en.catala_en-660"></a><span class="c1">  # Boolean operators include and, or, xor</span>
</pre></div>
</td></tr></table>
</div>

<h3 class='law-heading'><a href='#'>Integers</a></h3>
<p class='law-text'>Integers in Catala are infinite precision: they behave like true mathematical
integers, and not like computer integers that are bounded by a maximum value
due to them being stored in 32 or 64 bits. Integers can be negative.</p>
<div class='code-wrapper'>
<div class='filename'>tutorial_en.catala_en</div>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>
<span class="normal"><a href="#tutorial_en.catala_en-670">670</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-671">671</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-672">672</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-673">673</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-674">674</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-675">675</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-676">676</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-677">677</a></span>
</pre></div></td><td class="code"><div class="highlight"><pre>
<a id="tutorial_en.catala_en-670" name="tutorial_en.catala_en-670"></a><span class="kd">declaration</span> <span class="kd">scope</span> <span class="nc">IntegerValues</span><span class="o">:</span>
<a id="tutorial_en.catala_en-671" name="tutorial_en.catala_en-671"></a>  <span class="kd">internal</span> <span class="nv">value1</span> <span class="kd">content</span> <span class="kt">integer</span>
<a id="tutorial_en.catala_en-672" name="tutorial_en.catala_en-672"></a>  <span class="kd">internal</span> <span class="nv">value2</span> <span class="kd">content</span> <span class="kt">integer</span>
<a id="tutorial_en.catala_en-673" name="tutorial_en.catala_en-673"></a>
<a id="tutorial_en.catala_en-674" name="tutorial_en.catala_en-674"></a><span class="kd">scope</span> <span class="nc">IntegerValues</span><span class="o">:</span>
<a id="tutorial_en.catala_en-675" name="tutorial_en.catala_en-675"></a>  <span class="kd">definition</span> <span class="nv">value1</span> <span class="kd">under condition</span> <span class="mi">12</span> <span class="o">-</span> <span class="o">(</span><span class="mi">5</span> <span class="o">*</span> <span class="mi">3</span><span class="o">)</span> <span class="o">&lt;</span> <span class="mi">65</span> <span class="kd">consequence</span> <span class="kd">equals</span> <span class="mi">45</span> <span class="o">/</span> <span class="mi">9</span><span class="c1"></span>
<a id="tutorial_en.catala_en-676" name="tutorial_en.catala_en-676"></a><span class="c1">  # The / operators corresponds to an integer division that truncates towards 0.</span>
<a id="tutorial_en.catala_en-677" name="tutorial_en.catala_en-677"></a>  <span class="kd">definition</span> <span class="nv">value2</span> <span class="kd">equals</span> <span class="nv">value1</span> <span class="o">*</span> <span class="nv">value1</span> <span class="o">*</span> <span class="mi">65</span> <span class="o">/</span> <span class="mi">100</span>
</pre></div>
</td></tr></table>
</div>

<h3 class='law-heading'><a href='#'>Decimals</a></h3>
<p class='law-text'>Decimals in Catala also have infinite precisions, behaving like true mathematical
rational numbers, and not like computer floating point numbers that perform
approximate computations. Operators are suffixed with ".".</p>
<div class='code-wrapper'>
<div class='filename'>tutorial_en.catala_en</div>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>
<span class="normal"><a href="#tutorial_en.catala_en-687">687</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-688">688</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-689">689</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-690">690</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-691">691</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-692">692</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-693">693</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-694">694</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-695">695</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-696">696</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-697">697</a></span>
</pre></div></td><td class="code"><div class="highlight"><pre>
<a id="tutorial_en.catala_en-687" name="tutorial_en.catala_en-687"></a><span class="kd">declaration</span> <span class="kd">scope</span> <span class="nc">DecimalValues</span><span class="o">:</span>
<a id="tutorial_en.catala_en-688" name="tutorial_en.catala_en-688"></a>  <span class="kd">internal</span> <span class="nv">value1</span> <span class="kd">content</span> <span class="kt">decimal</span>
<a id="tutorial_en.catala_en-689" name="tutorial_en.catala_en-689"></a>  <span class="kd">internal</span> <span class="nv">value2</span> <span class="kd">content</span> <span class="kt">decimal</span>
<a id="tutorial_en.catala_en-690" name="tutorial_en.catala_en-690"></a>
<a id="tutorial_en.catala_en-691" name="tutorial_en.catala_en-691"></a><span class="kd">scope</span> <span class="nc">DecimalValues</span><span class="o">:</span>
<a id="tutorial_en.catala_en-692" name="tutorial_en.catala_en-692"></a>  <span class="kd">definition</span> <span class="nv">value1</span> <span class="kd">under condition</span>
<a id="tutorial_en.catala_en-693" name="tutorial_en.catala_en-693"></a>    <span class="mi">12</span><span class="o">.</span><span class="mi">655465446655426</span> <span class="o">-.</span> <span class="mi">0</span><span class="o">.</span><span class="mi">45265426541654</span>  <span class="o">&lt;.</span> <span class="mi">12</span><span class="o">.</span><span class="mi">3554654652</span> <span class="kd">consequence</span>
<a id="tutorial_en.catala_en-694" name="tutorial_en.catala_en-694"></a>  <span class="kd">equals</span> <span class="o">(</span><span class="nv">integer_to_decimal</span> <span class="kr">of</span> <span class="mi">45</span><span class="o">)</span> <span class="o">/.</span> <span class="o">(</span><span class="nv">integer_to_decimal</span> <span class="kr">of</span> <span class="mi">9</span><span class="o">)</span><span class="c1"></span>
<a id="tutorial_en.catala_en-695" name="tutorial_en.catala_en-695"></a><span class="c1">  # The /. operators corresponds to an exact division.</span>
<a id="tutorial_en.catala_en-696" name="tutorial_en.catala_en-696"></a>  <span class="kd">definition</span> <span class="nv">value2</span> <span class="kd">equals</span> <span class="nv">value1</span> <span class="o">*.</span> <span class="nv">value1</span> <span class="o">*.</span> <span class="mi">65</span><span class="o">%</span><span class="c1"></span>
<a id="tutorial_en.catala_en-697" name="tutorial_en.catala_en-697"></a><span class="c1">  # Percentages are decimal numbers (0.65 here)</span>
</pre></div>
</td></tr></table>
</div>

<h3 class='law-heading'><a href='#'>Money</a></h3>
<p class='law-text'>In Catala, money is simply represented as an integer number of cents. You cannot
in Catala have a more precise amount of money than a cent. However, you can
muliply an amount of money by a decimal, and the result is rounded towards the
nearest cent. This principled behaviour to keep track of where you need precision
in your computations and select decimals for precision instead of relying on
money figures where sub-cent precision matters. Two money amounts can be divided,
yielding a decimal.</p>
<div class='code-wrapper'>
<div class='filename'>tutorial_en.catala_en</div>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>
<span class="normal"><a href="#tutorial_en.catala_en-711">711</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-712">712</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-713">713</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-714">714</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-715">715</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-716">716</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-717">717</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-718">718</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-719">719</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-720">720</a></span>
</pre></div></td><td class="code"><div class="highlight"><pre>
<a id="tutorial_en.catala_en-711" name="tutorial_en.catala_en-711"></a><span class="kd">declaration</span> <span class="kd">scope</span> <span class="nc">MoneyValues</span><span class="o">:</span>
<a id="tutorial_en.catala_en-712" name="tutorial_en.catala_en-712"></a>  <span class="kd">internal</span> <span class="nv">value1</span> <span class="kd">content</span> <span class="kt">decimal</span>
<a id="tutorial_en.catala_en-713" name="tutorial_en.catala_en-713"></a>  <span class="kd">internal</span> <span class="nv">value2</span> <span class="kd">content</span> <span class="kt">money</span>
<a id="tutorial_en.catala_en-714" name="tutorial_en.catala_en-714"></a>
<a id="tutorial_en.catala_en-715" name="tutorial_en.catala_en-715"></a><span class="kd">scope</span> <span class="nc">MoneyValues</span><span class="o">:</span>
<a id="tutorial_en.catala_en-716" name="tutorial_en.catala_en-716"></a>  <span class="kd">definition</span> <span class="nv">value1</span> <span class="kd">under condition</span>
<a id="tutorial_en.catala_en-717" name="tutorial_en.catala_en-717"></a>    <span class="mi">12</span><span class="o">.</span><span class="mi">655465446655426</span> <span class="o">-.</span> <span class="mi">0</span><span class="o">.</span><span class="mi">45265426541654</span>  <span class="o">&lt;.</span> <span class="mi">12</span><span class="o">.</span><span class="mi">3554654652</span> <span class="kd">consequence</span>
<a id="tutorial_en.catala_en-718" name="tutorial_en.catala_en-718"></a>  <span class="kd">equals</span> <span class="o">(</span><span class="nv">integer_to_decimal</span> <span class="kr">of</span> <span class="mi">45</span><span class="o">)</span> <span class="o">/.</span> <span class="o">(</span><span class="nv">integer_to_decimal</span> <span class="kr">of</span> <span class="mi">9</span><span class="o">)</span>
<a id="tutorial_en.catala_en-719" name="tutorial_en.catala_en-719"></a>  <span class="kd">definition</span> <span class="nv">value2</span> <span class="kd">equals</span>
<a id="tutorial_en.catala_en-720" name="tutorial_en.catala_en-720"></a>    <span class="o">$</span><span class="mi">1</span><span class="o">.</span><span class="mi">00</span> <span class="o">*$</span> <span class="o">((($</span><span class="mi">6,520</span><span class="o">.</span><span class="mi">23</span> <span class="o">-$</span> <span class="o">$</span><span class="mi">320</span><span class="o">.</span><span class="mi">45</span><span class="o">)</span> <span class="o">*$</span> <span class="nv">value1</span><span class="o">)</span> <span class="o">/$</span> <span class="o">$</span><span class="mi">45</span><span class="o">)</span>
</pre></div>
</td></tr></table>
</div>

<h3 class='law-heading'><a href='#'>Dates and durations</a></h3>
<p class='law-text'>Catala has support for Gregorian calendar dates as well as duration computations
in terms of days, months and years. A difference between dates is a duration
measured in days, and the addition of a date and a duration yields a new date.
Durations measured in days, months or years are not mixable with each other,
as months and years do not always have the same number of days. This non-mixability
is not captured by the type system of Catala but will yield errors at runtime.
Date literals are specified using the ISO 8601 standard to avoid confusion between
american and european notations. Date operators are prefixed by "@" while
duration operators are prefixed by "^".</p>
<div class='code-wrapper'>
<div class='filename'>tutorial_en.catala_en</div>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>
<span class="normal"><a href="#tutorial_en.catala_en-737">737</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-738">738</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-739">739</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-740">740</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-741">741</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-742">742</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-743">743</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-744">744</a></span>
</pre></div></td><td class="code"><div class="highlight"><pre>
<a id="tutorial_en.catala_en-737" name="tutorial_en.catala_en-737"></a><span class="kd">declaration</span> <span class="kd">scope</span> <span class="nc">DateValues</span><span class="o">:</span>
<a id="tutorial_en.catala_en-738" name="tutorial_en.catala_en-738"></a>  <span class="kd">internal</span> <span class="nv">value1</span> <span class="kd">content</span> <span class="kt">date</span>
<a id="tutorial_en.catala_en-739" name="tutorial_en.catala_en-739"></a>  <span class="kd">internal</span> <span class="nv">value2</span> <span class="kd">content</span> <span class="kt">duration</span>
<a id="tutorial_en.catala_en-740" name="tutorial_en.catala_en-740"></a>
<a id="tutorial_en.catala_en-741" name="tutorial_en.catala_en-741"></a><span class="kd">scope</span> <span class="nc">DateValues</span><span class="o">:</span>
<a id="tutorial_en.catala_en-742" name="tutorial_en.catala_en-742"></a>  <span class="kd">definition</span> <span class="nv">value1</span> <span class="kd">equals</span> <span class="mi">|2000-01-01|</span> <span class="o">+@</span> <span class="mi">1</span> <span class="o">year</span><span class="c1"> # yields |2001-01-01|</span>
<a id="tutorial_en.catala_en-743" name="tutorial_en.catala_en-743"></a>  <span class="kd">definition</span> <span class="nv">value2</span> <span class="kd">equals</span>
<a id="tutorial_en.catala_en-744" name="tutorial_en.catala_en-744"></a>    <span class="o">(</span><span class="nv">value1</span> <span class="o">-@</span> <span class="mi">|1999-12-31|</span><span class="o">)</span> <span class="o">+^</span> <span class="mi">45</span> <span class="o">day</span><span class="c1"> # 367 + 45 days (2000 is bissextile)</span>
</pre></div>
</td></tr></table>
</div>

<h3 class='law-heading'><a href='#'>Collections</a></h3>
<p class='law-text'>Often, Catala programs need to speak about a collection of data because the law
talks about the number of children, the maximum of a list, etc. Catala features
first-class support for collections, which are basically fixed-size lists.
You can create a list, filter its elements but also aggregate over its contents
to compute all sorts of values.</p>
<div class='code-wrapper'>
<div class='filename'>tutorial_en.catala_en</div>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>
<span class="normal"><a href="#tutorial_en.catala_en-756">756</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-757">757</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-758">758</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-759">759</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-760">760</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-761">761</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-762">762</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-763">763</a></span>
</pre></div></td><td class="code"><div class="highlight"><pre>
<a id="tutorial_en.catala_en-756" name="tutorial_en.catala_en-756"></a><span class="kd">declaration</span> <span class="kd">scope</span> <span class="nc">CollectionValues</span><span class="o">:</span>
<a id="tutorial_en.catala_en-757" name="tutorial_en.catala_en-757"></a>  <span class="kd">internal</span> <span class="nv">value1</span> <span class="kd">content</span> <span class="kd">collection</span> <span class="kt">integer</span>
<a id="tutorial_en.catala_en-758" name="tutorial_en.catala_en-758"></a>  <span class="kd">internal</span> <span class="nv">value2</span> <span class="kd">content</span> <span class="kt">integer</span>
<a id="tutorial_en.catala_en-759" name="tutorial_en.catala_en-759"></a>
<a id="tutorial_en.catala_en-760" name="tutorial_en.catala_en-760"></a><span class="kd">scope</span> <span class="nc">CollectionValues</span><span class="o">:</span>
<a id="tutorial_en.catala_en-761" name="tutorial_en.catala_en-761"></a>  <span class="kd">definition</span> <span class="nv">value1</span> <span class="kd">equals</span> <span class="o">[</span><span class="mi">45</span><span class="o">;-</span><span class="mi">6</span><span class="o">;</span><span class="mi">3</span><span class="o">;</span><span class="mi">4</span><span class="o">;</span><span class="mi">0</span><span class="o">;</span><span class="mi">2155</span><span class="o">]</span>
<a id="tutorial_en.catala_en-762" name="tutorial_en.catala_en-762"></a>  <span class="kd">definition</span> <span class="nv">value2</span> <span class="kd">equals</span> <span class="kt">sum</span> <span class="kt">integer</span> <span class="kr">for</span> <span class="nv">i</span> <span class="kr">in</span> <span class="nv">value1</span> <span class="kr">of</span> <span class="o">(</span><span class="nv">i</span> <span class="o">*</span> <span class="nv">i</span><span class="o">)</span><span class="c1"></span>
<a id="tutorial_en.catala_en-763" name="tutorial_en.catala_en-763"></a><span class="c1">  # sum of squares</span>
</pre></div>
</td></tr></table>
</div>

<h2 class='law-heading'><a href='#'>Conclusion</a></h2>
<p class='law-text'>This tutorial presents the basic concepts and syntax of the Catala language
features. It is then up to you use them to annotate legislative texts
with their algorithmic translation.<br/>
There is no single way to write Catala programs, as the program style should be
adapted to the legislation it annotates. However, Catala is a functional
language at heart, so following standard functional programming design patterns
should help achieve concise and readable code.</p>